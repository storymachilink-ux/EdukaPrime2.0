================================================================================
  REFATORA√á√ÉO DO SISTEMA DE PLANOS - QUICK START
================================================================================

SITUA√á√ÉO ATUAL:
  ‚ùå Sistema t√° quebrado
  ‚ùå Duas abordagens misturadas
  ‚ùå Permiss√µes n√£o funcionam
  ‚ùå Admin panel confuso

SOLU√á√ÉO:
  ‚úÖ Novo sistema simples
  ‚úÖ Funciona perfeito
  ‚úÖ Admin f√°cil
  ‚úÖ Suporta vital√≠cio + mensal

================================================================================
ARQUIVOS CRIADOS:
================================================================================

1. REFACTOR_PLANS_SYSTEM_V2.sql
   ‚Üí SQL COMPLETO pra refazer o banco
   ‚Üí Execute no Supabase SQL Editor

2. PASSOS_SUPABASE.md
   ‚Üí Instru√ß√µes passo-a-passo (9 passos)
   ‚Üí Com verifica√ß√µes

3. ARQUITETURA_NOVA_PLANOS.md
   ‚Üí Documenta√ß√£o visual completa
   ‚Üí Fluxos de compra
   ‚Üí Diagramas

4. INSTRUCOES_CLEANUP_BANCO.md
   ‚Üí O que EXCLUIR do banco
   ‚Üí O que REESCREVER no frontend
   ‚Üí Checklist

5. README_REFACTOR_PLANOS.md
   ‚Üí Overview completo
   ‚Üí Checklist de implementa√ß√£o

================================================================================
LEIA NESTA ORDEM:
================================================================================

1Ô∏è‚É£  README_REFACTOR_PLANOS.md (5 min)
    ‚îî‚îÄ Entender o problema e a solu√ß√£o

2Ô∏è‚É£  PASSOS_SUPABASE.md (30 min)
    ‚îî‚îÄ Executar no Supabase (copy & paste)

3Ô∏è‚É£  ARQUITETURA_NOVA_PLANOS.md (15 min)
    ‚îî‚îÄ Entender como funciona

4Ô∏è‚É£  INSTRUCOES_CLEANUP_BANCO.md (10 min)
    ‚îî‚îÄ Pr√≥ximos passos no frontend

================================================================================
RESUMO DA SOLU√á√ÉO:
================================================================================

ANTES: plans (JSONB granular)           DEPOIS: plans_v2 (simples)
       ‚îú‚îÄ atividades: [item1, item2]           ‚îú‚îÄ id: 0-4
       ‚îú‚îÄ videos: [...]                        ‚îú‚îÄ name: GRATUITO, ESSENCIAL...
       ‚îî‚îÄ ...                                  ‚îî‚îÄ is_active: true/false

ANTES: plans (confuso)                  DEPOIS: plan_features (claro)
                                               ‚îú‚îÄ (plan_id=1, atividades): true
                                               ‚îú‚îÄ (plan_id=1, videos): false
                                               ‚îî‚îÄ ...

ANTES: users.plano_id VARCHAR          DEPOIS: users.active_plan_id INT
                                              users.has_lifetime_access BOOL

ANTES: (nada)                          DEPOIS: user_subscriptions
                                              ‚îú‚îÄ Rastreia todas as compras
                                              ‚îú‚îÄ Suporta m√∫ltiplas subscriptions
                                              ‚îî‚îÄ Hist√≥rico completo

================================================================================
DADOS QUE VAI TER:
================================================================================

5 PLANOS:
  0 ‚Üí GRATUITO      (R$ 0,00 / mensal)
  1 ‚Üí ESSENCIAL     (R$ 17,99 / mensal)
  2 ‚Üí EVOLUIR       (R$ 27,99 / mensal)
  3 ‚Üí PRIME         (R$ 49,99 / mensal)
  4 ‚Üí VITAL√çCIO     (R$ 197,99 / √∫nico)

6 FEATURES (cada plano libera ou n√£o):
  - atividades
  - videos
  - bonus
  - papercrafts
  - comunidade
  - suporte_vip

ACESSO POR PLANO:
  GRATUITO:    ‚ùå Nada
  ESSENCIAL:   ‚úÖ Atividades
  EVOLUIR:     ‚úÖ Atividades, V√≠deos, B√¥nus
  PRIME:       ‚úÖ Tudo + Comunidade + Suporte VIP
  VITAL√çCIO:   ‚úÖ Tudo para sempre

================================================================================
FLUXO R√ÅPIDO:
================================================================================

USER NOVO:
  signup() ‚Üí active_plan_id=0 (GRATUITO) ‚Üí sem acesso

USER COMPRA ESSENCIAL (PIX):
  click "Contratar" ‚Üí GGCheckout ‚Üí paga ‚Üí webhook ‚Üí
  activate_user_subscription(user, plan=1) ‚Üí active_plan_id=1 ‚Üí acesso atividades ‚úÖ

USER UPGRADE PARA PRIME:
  click "Upgrade" ‚Üí webhook ‚Üí desativa plan=1 ‚Üí cria plan=3 ‚Üí acesso tudo ‚úÖ

USER COMPRA VITAL√çCIO:
  click "Vital√≠cio" ‚Üí webhook ‚Üí has_lifetime_access=true ‚Üí acesso permanente ‚úÖ

================================================================================
VERIFICA√á√ÉO DE ACESSO:
================================================================================

SQL (direto):
  SELECT user_has_feature_access('user-id', 'videos')
  ‚Üí true/false

TypeScript (no c√≥digo):
  const hasAccess = await planService.hasAccess(userId, 'videos');
  if (!hasAccess) showUpgradeModal();

Query SQL:
  SELECT pf.is_enabled
  FROM plan_features pf
  WHERE pf.plan_id = (SELECT active_plan_id FROM users WHERE id = ?)
  AND pf.feature_name = 'videos'

================================================================================
PR√ìXIMOS PASSOS:
================================================================================

1. Executar REFACTOR_PLANS_SYSTEM_V2.sql no Supabase
   ‚îî‚îÄ Cria tabelas: plans_v2, plan_features, user_subscriptions

2. Reescrever src/lib/planService.ts
   ‚îî‚îÄ Usar novas tabelas

3. Atualizar src/contexts/AuthContext.tsx
   ‚îî‚îÄ Carregar active_plan_id + has_lifetime_access

4. Criar src/pages/admin/AdminPlanosManager.tsx
   ‚îî‚îÄ MUITO mais simples (lista + editar)

5. Deletar src/pages/admin/GestaoPlanos.tsx
   ‚îî‚îÄ Era complicado demais

6. Atualizar webhook handler
   ‚îî‚îÄ Chamar activate_user_subscription()

================================================================================
TESTE R√ÅPIDO:
================================================================================

No Supabase SQL Editor:

1. SELECT COUNT(*) FROM plans_v2;
   ‚Üí Deve retornar 5

2. SELECT COUNT(*) FROM plan_features;
   ‚Üí Deve retornar 30 (5 planos √ó 6 features)

3. SELECT * FROM user_current_access LIMIT 1;
   ‚Üí Deve retornar dados do usu√°rio

4. SELECT user_has_feature_access('user-uuid', 'videos');
   ‚Üí Deve retornar true/false

================================================================================
TEMPO ESTIMADO:
================================================================================

Banco (Supabase):        45 minutos
Frontend (reescrever):   3-4 horas
Testes:                  2 horas
Total:                   ~5 horas

================================================================================
D√öVIDAS?
================================================================================

Leia:
  ‚Ä¢ ARQUITETURA_NOVA_PLANOS.md    ‚Üí Entender a arquitetura
  ‚Ä¢ INSTRUCOES_CLEANUP_BANCO.md    ‚Üí O que excluir/reescrever
  ‚Ä¢ PASSOS_SUPABASE.md             ‚Üí Passo-a-passo SQL

================================================================================

Vamo nessa! üöÄ
