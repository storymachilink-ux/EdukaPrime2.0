â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    MÃšLTIPLAS PLATAFORMAS DE VÃDEO
                        RESUMO RÃPIDO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ OBJETIVO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Permitir armazenar YouTube, Wistia e Vturb para cada vÃ­deo com fallback automÃ¡tico.

ğŸ“Š ARQUITETURA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ANTES (YouTube only):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   videos    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚
â”‚ title       â”‚
â”‚ youtube_url â”‚ â† ÃšNICO (sem alternativas)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DEPOIS (MÃºltiplas plataformas):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   videos    â”‚â—„â”€â”€â”€â”€â”€â”€nâ”€ mâ”‚ video_sources    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚         â”‚ id               â”‚
â”‚ title       â”‚         â”‚ video_id    (FK) â”‚
â”‚ description â”‚         â”‚ source_type      â”‚
â”‚ category    â”‚         â”‚ source_data      â”‚
â”‚ ...         â”‚         â”‚ is_primary (*)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    YouTube | Wistia | Vturb

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ ARQUIVOS CRIADOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. supabase/migrations/20250127000100_add_video_sources.sql
   â””â”€ MigraÃ§Ã£o SQL principal (EXECUTAR NO SUPABASE)
   â””â”€ Cria tabela, Ã­ndices, RPCs e RLS
   â””â”€ Migra dados automaticamente

2. supabase/migrations/VIDEO_SOURCES_GUIDE.md
   â””â”€ DocumentaÃ§Ã£o tÃ©cnica detalhada
   â””â”€ Exemplos de dados por plataforma
   â””â”€ Como usar as RPCs

3. supabase/migrations/TEST_video_sources.sql
   â””â”€ Script para testar a migraÃ§Ã£o
   â””â”€ Valida tabela, Ã­ndices, RLS, dados

4. INSTRUCOES_VIDEO_SOURCES.md
   â””â”€ InstruÃ§Ãµes passo-a-passo
   â””â”€ Guia de execuÃ§Ã£o
   â””â”€ Troubleshooting

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ EXECUTAR AGORA (3 passos)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PASSO 1: Executar migraÃ§Ã£o SQL
  1. Abra: https://app.supabase.com/
  2. Projeto â†’ SQL Editor â†’ + New Query
  3. Cole: supabase/migrations/20250127000100_add_video_sources.sql
  4. Clique: Run
  5. Resultado: âœ… CREATE FUNCTION, GRANT EXECUTE

PASSO 2: Testar migraÃ§Ã£o
  1. SQL Editor â†’ + New Query
  2. Cole: supabase/migrations/TEST_video_sources.sql
  3. Execute queries uma por uma
  4. Verifique: tabela criada, dados migrados, RLS ativado

PASSO 3: Validar dados
  SQL:
  SELECT COUNT(*) FROM public.video_sources;

  Resultado esperado:
  âœ… MÃºltiplas linhas (um registro por vÃ­deo YouTube existente)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š TABELA: video_sources
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Coluna        | Tipo              | DescriÃ§Ã£o
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
id            | UUID              | Identificador Ãºnico
video_id      | UUID (FK)         | Qual vÃ­deo (videos.id)
source_type   | VARCHAR(50)       | 'youtube'|'wistia'|'vturb'
source_data   | JSONB             | Dados da plataforma
is_primary    | BOOLEAN           | Qual usar como padrÃ£o
created_at    | TIMESTAMPTZ       | Quando criada
updated_at    | TIMESTAMPTZ       | Ãšltima mudanÃ§a

Constraint: UNIQUE(video_id, source_type)
  â†’ MÃ¡ximo 1 source de cada tipo por vÃ­deo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’¾ DADOS POR PLATAFORMA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

YOUTUBE
  URL de entrada: https://www.youtube.com/watch?v=JvmXVeem2lI
  source_data:
  {
    "video_id": "JvmXVeem2lI",
    "url": "https://www.youtube.com/watch?v=JvmXVeem2lI",
    "thumbnail": "https://img.youtube.com/vi/JvmXVeem2lI/hqdefault.jpg"
  }

WISTIA
  Entrada: <script src="..."></script><wistia-player media-id="78docpnbgg">...
  source_data:
  {
    "media_id": "78docpnbgg",
    "embed_code": "...",
    "thumbnail": "https://fast.wistia.com/embed/medias/78docpnbgg/swatch"
  }

VTURB
  Entrada: <vturb-smartplayer id="vid-691cb6488e05537f6925540e">...
  source_data:
  {
    "player_id": "vid-691cb6488e05537f6925540e",
    "embed_code": "...",
    "thumbnail": "..."
  }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ RPCs (FunÃ§Ãµes SQL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. create_or_update_video_source(video_id, source_type, source_data, is_primary)
   â””â”€ Criar ou atualizar uma source
   â””â”€ Retorna: { id, source_type, is_primary, created_at }

2. get_video_sources(video_id)
   â””â”€ Obter TODAS as sources de um vÃ­deo
   â””â”€ Retorna: [{ id, source_type, source_data, is_primary, created_at }]

3. get_primary_video_source(video_id)
   â””â”€ Obter APENAS a source primÃ¡ria
   â””â”€ Retorna: { id, source_type, source_data, created_at }

4. delete_video_source(source_id)
   â””â”€ Deletar uma source especÃ­fica
   â””â”€ Se Ã© primÃ¡ria, promove outra automaticamente
   â””â”€ Retorna: { success, message }

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”’ SEGURANÃ‡A (RLS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SELECT (LER):
  âœ… Qualquer um pode ler (pÃºblico)

INSERT/UPDATE/DELETE (MODIFICAR):
  ğŸ”’ Apenas service_role (backend)

Resultado:
  âœ… UsuÃ¡rios normais: leem vÃ­deos
  ğŸ”’ Admin: edita via RPC no frontend (serÃ¡ criado depois)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ FLUXO COMPLETO (Futuro)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Admin edita vÃ­deo:
  1. Seleciona tipo: [YouTube] [Wistia] [Vturb]
  2. Cola URL/cÃ³digo
  3. Sistema detecta automaticamente qual plataforma
  4. Preview em tempo real
  5. Salva em video_sources

UsuÃ¡rio assiste:
  1. Clica no vÃ­deo
  2. Player universal detecta source_type
  3. Renderiza correto (YouTube iframe | Wistia embed | Vturb embed)
  4. Se falhar uma, fallback para outra

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ CHECKLIST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Fase 1 (SQL): â† VOCÃŠ ESTÃ AQUI
  â˜ Executar migraÃ§Ã£o no Supabase
  â˜ Testar com script de teste
  â˜ Validar dados migrados

Fase 2 (React Components): â† PRÃ“XIMO
  â˜ VideoSourceSelector (tabs)
  â˜ VideoSourceInput (campo dinÃ¢mico)
  â˜ VideoSourcePreview (prÃ©-visualizaÃ§Ã£o)
  â˜ VideoPlayer universal

Fase 3 (Admin UI):
  â˜ Atualizar GestaoVideos.tsx
  â˜ CTRL+C / CTRL+V inteligente
  â˜ Testes E2E

Fase 4 (Frontend):
  â˜ Atualizar Videos.tsx
  â˜ Atualizar dashboard/Videos.tsx
  â˜ Suporte a fallback

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â“ PRÃ“XIMO PASSO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ApÃ³s executar SQL:
  1. Avise quando a migraÃ§Ã£o estiver completa
  2. Vamos para Fase 2: Componentes React

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
